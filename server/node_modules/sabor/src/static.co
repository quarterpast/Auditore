Q = require \q
mime = require \mime
path = require \path
fs = require \fs

cache = {}
exports@Static.file = function file filename
	->
		if filename in cache then return cache[filename]
		Q.ncall fs.readFile, fs, filename .then (data)->
			cache[filename] =
				body: [data]
				headers: {\content-type : mime.lookup filename}
				status: 200
		,(e)->status: 404
exports.Static.dir = function dir dirname
	(req,p)-> (exports.Static.file path.join dirname,p)!

exports.Redirect = function Redirect location
	status: 302 headers:{location}